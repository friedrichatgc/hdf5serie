#! /bin/sh

H=0 # option -h, --help: help
D=0 # option -d: show description
L=0 # optoin -l: show Column/Member Label
F=0 # option -f: follow external links
while test $# -ne 0; do
  case $1 in
    -d)        D=1;;
    -h|--help) H=1;;
    -l)        L=1;;
    -f)        F=1;;
    -*)        echo "Invalid option: $1; see output of h5lsserie"
               exit 1;;
    *)         FILE=$1;;
  esac
  shift
done

if [ $H -eq 1 ]; then
  echo "Lists the groups and datasets in a hdf5 file."
  echo ""
  echo "Usage:"
  echo "  h5lsserie [-d] [-l] <file.h5>"
  echo "    -h, --help: Show this help"
  echo "    -d:         Show 'Description' attribute"
  echo "    -l:         Show 'Column/Member Label'"
  echo "    -f:         Follow external links"
  exit 0
fi

prefix=@prefix@

# create XML dump (without data) of all *.mbsim.h5 files in the
# directory of file FILE (save in current directory)
DIR=$(dirname $FILE)
for SUBFILE in $DIR/*.mbsim.h5; do
  @h5dump@ -xA $SUBFILE > .$(basename $SUBFILE).xml
done

# call xslt
xsltproc --path . --param FILENAME "'$FILE'" --param LABEL $L --param DESCRIPTION $D --param FOLLOW $F @datadir@/hdf5serie/xsl/h5lsserie.xsl .$(basename $FILE).xml

# delete all previous created *.mbsim.h5.xml files
for SUBFILE in $DIR/*.mbsim.h5; do
  rm -f .$(basename $SUBFILE).xml
done
