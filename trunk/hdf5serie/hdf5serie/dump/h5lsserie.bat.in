@echo off
rem Windows batch variant of h5lsserie (h5lsserie.bat.in)
rem If editing this file, edit also the file h5lsserie.in!
rem
rem Copyright (C) 2009 Markus Friedrich
rem
rem This library is free software; you can redistribute it and/or 
rem modify it under the terms of the GNU Lesser General Public 
rem License as published by the Free Software Foundation; either 
rem version 2.1 of the License, or (at your option) any later version. 
rem  
rem This library is distributed in the hope that it will be useful, 
rem but WITHOUT ANY WARRANTY; without even the implied warranty of 
rem MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
rem Lesser General Public License for more details. 
rem  
rem You should have received a copy of the GNU Lesser General Public 
rem License along with this library; if not, write to the Free Software 
rem Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301 USA
rem
rem Contact:
rem   mafriedrich@users.berlios.de
rem

set "H=0" rem option -h, --help: help
set "D=0" rem option -d: show description
set "L=0" rem optoin -l: show Column/Member Label
set "F=0" rem option -f: follow external links
set FILE=""
set FILEDIRNAME=""
set FILEBASENAME=""
:beginfor
if %1!==! goto continue
  if "%1"=="-d" (
    set "D=1"
    shift
    goto beginfor
  )
  if "%1"=="-h" ( 
    set "H=1"
    shift
    goto beginfor
  )
  if "%1"=="--help" (
    set "H=1"
    shift
    goto beginfor
  )
  if "%1"=="-l" (
    set "L=1"
    shift
    goto beginfor
  )
  if "%1"=="-f" (
    set "F=1"
    shift
    goto beginfor
  )
  set FILE=%1
  set FILEDIRNAME=%~dp1
  set FILEBASENAME=%~n1
  shift
goto beginfor
:continue

if not "%H%"=="1" goto afterhelp
  echo "h5lsserie"
  echo ""
  echo "Lists the groups and datasets in a hdf5 file."
  echo ""
  echo "Copyright (C) 2009 Markus Friedrich <mafriedrich@users.berlios.de>"
  echo "This is free software; see the source for copying conditions. There is NO"
  echo "warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
  echo "Licensed under the GNU Lesser General Public License (LGPL)"
  echo ""
  echo "Usage:"
  echo "  h5lsserie [-d] [-l] <file.h5>"
  echo "    -h, --help: Show this help"
  echo "    -d:         Show 'Description' attribute"
  echo "    -l:         Show 'Column/Member Label'"
  echo "    -f:         Follow external links"
  goto end
:afterhelp

set datadir=@win_prefix@/share

rem create XML dump (without data) of all *.h5 files in the
rem directory of file FILE (save as .*.h5.xml)
cd %FILEDIRNAME%
for %%S in (*.h5 %FILE%) do (
  @win_h5dump@ -xA %%S > .%%S.xml
)

rem call xslt
if not "@win_xsltproc@" == "no" (
  @win_xsltproc@ --path . --param FILENAME "'%FILE%'" --param LABEL %L% --param DESCRIPTION %D% --param FOLLOW %F% %datadir%/hdf5serie/xsl/h5lsserie.xsl .%FILEBASENAME%.h5.xml
) else (
  if not "@win_msxsl@" == "no" (
    @win_msxsl@ .%FILEBASENAME%.h5.xml %datadir%/hdf5serie/xsl/h5lsserie.xsl FILENAME="%FILE%" LABEL=%L% DESCRIPTION=%D% FOLLOW=%F%
  )
)

rem delete all previous created .*.h5.xml files
for %%S in (*.h5 %FILE%) do (
  del .%%S.xml
)

:end
